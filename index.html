<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Log</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<style>
    body {
        font-family: "Poppins", sans-serif;
        font-weight: 400;
        font-style: normal;
    }
    .container {
        max-width: 800px;
    }
    .actions-column {
        width: 170px; /* Adjust the width as needed */
    }
    .time-info {
        display: flex;
        justify-content: space-between;
    }
</style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4 d-flex justify-content-between align-items-center">Time Log <button id="clearAllButton" class="btn btn-danger btn-sm" onclick="clearAll()">Clear All</button></h1>
        <div id="form">
            <div class="form-group">
                <label for="task">Task:</label>
                <input type="text" class="form-control" id="task" placeholder="Enter task">
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="hours">Hours:</label>
                    <input type="number" class="form-control" id="hours" placeholder="0">
                </div>
                <div class="form-group col-md-6">
                    <label for="minutes">Minutes:</label>
                    <input type="number" class="form-control" id="minutes" placeholder="0">
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button id="addUpdateButton" class="btn btn-primary mr-2" onclick="addOrUpdateTask()">Add Task</button>
                <button id="cancelButton" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
            </div>
        </div>
        <div id="log" class="mt-4">
            <h2>Log</h2>
            <table class="table table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th>Task</th>
                        <th>Duration</th>
                        <th class="actions-column">Actions</th>
                    </tr>
                </thead>
                <tbody id="logBody"></tbody>
            </table>
            <div class="time-info mt-3">
                <p class="font-weight-bold">Total Duration: <span id="totalDuration">0h 0m</span></p>
                <p class="font-weight-bold">Remaining Time: <span id="remainingTime">7h 0m</span></p>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    var editingIndex = -1;

    // Function to add or update a task
    function addOrUpdateTask() {
        var taskInput = $("#task");
        var hoursInput = $("#hours");
        var minutesInput = $("#minutes");

        var task = taskInput.val();
        var hours = parseInt(hoursInput.val()) || 0;
        var minutes = parseInt(minutesInput.val()) || 0;

        if (task === "") {
            alert("Please enter a task.");
            return;
        }

        // Retrieve existing log from localStorage or initialize an empty array
        var log = JSON.parse(localStorage.getItem("timeLog")) || [];

        if (editingIndex === -1) {
            // Add a new task to the log
            log.push({
                task: task,
                duration: hours * 60 + minutes
            });
        } else {
            // Update the existing task in the log
            log[editingIndex] = {
                task: task,
                duration: hours * 60 + minutes
            };
            editingIndex = -1; // Reset editing index
            $("#addUpdateButton").text("Add Task"); // Change button text back to "Add Task"
        }

        // Save the updated log to localStorage
        localStorage.setItem("timeLog", JSON.stringify(log));

        // Clear input fields
        taskInput.val("");
        hoursInput.val("");
        minutesInput.val("");

        // Refresh the log display
        displayLog();
    }

    // Function to display the log
    function displayLog() {
        var log = JSON.parse(localStorage.getItem("timeLog")) || [];
        var logBody = $("#logBody");
        var totalDuration = $("#totalDuration");
        var remainingTime = $("#remainingTime");
        logBody.empty();

        var totalMinutes = 0;

        log.forEach(function(item, index) {
            var row = $("<tr>");
            $("<td>").text(item.task).appendTo(row);

            var hours = Math.floor(item.duration / 60);
            var minutes = item.duration % 60;
            $("<td>").text(hours + "h " + minutes + "m").appendTo(row);

            var actionsCell = $("<td>");
            $("<button>").text("Edit").addClass("btn btn-primary btn-sm mr-1").on("click", function() {
                editTask(index);
            }).appendTo(actionsCell);

            $("<button>").text("Delete").addClass("btn btn-danger btn-sm").on("click", function() {
                if (confirm("Are you sure you want to delete this task?")) {
                    deleteTask(index);
                }
            }).appendTo(actionsCell);

            actionsCell.appendTo(row);
            row.appendTo(logBody);

            totalMinutes += item.duration;
        });

        var totalHours = Math.floor(totalMinutes / 60);
        var totalRemainingMinutes = totalMinutes % 60;
        totalDuration.text(totalHours + "h " + totalRemainingMinutes + "m");

        // Calculate remaining time
        var remainingTotalMinutes = 7 * 60 - totalMinutes;
        var remainingTotalHours = Math.floor(remainingTotalMinutes / 60);
        var remainingRemainingMinutes = remainingTotalMinutes % 60;
        remainingTime.text(remainingTotalHours + "h " + remainingRemainingMinutes + "m");
    }

    // Function to cancel editing
    function cancelEdit() {
        editingIndex = -1; // Reset editing index
        $("#addUpdateButton").text("Add Task"); // Change button text back to "Add Task"
        $("#task").val(""); // Clear task input
        $("#hours").val(""); // Clear hours input
        $("#minutes").val(""); // Clear minutes input
    }

    // Function to delete a task
    function deleteTask(index) {
        var log = JSON.parse(localStorage.getItem("timeLog")) || [];
        log.splice(index, 1);
        localStorage.setItem("timeLog", JSON.stringify(log));
        displayLog();
    }

    // Function to clear all tasks
    function clearAll() {
        if (confirm("Are you sure you want to clear all tasks?")) {
            localStorage.removeItem("timeLog");
            displayLog();
        }
    }

    // Function to edit a task
    function editTask(index) {
        var log = JSON.parse(localStorage.getItem("timeLog")) || [];
        var task = log[index];
        editingIndex = index; // Set editing index
        $("#task").val(task.task);
        var hours = Math.floor(task.duration / 60);
        var minutes = task.duration % 60;
        $("#hours").val(hours);
        $("#minutes").val(minutes);
        $("#addUpdateButton").text("Update Task");
    }

    // Call displayLog function when the page loads
    displayLog();
</script>
</body>
</html>
